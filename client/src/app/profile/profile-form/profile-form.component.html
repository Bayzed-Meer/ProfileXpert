<form
  [formGroup]="profileForm"
  (ngSubmit)="onSubmit()"
  enctype="multipart/form-data"
  class="max-w-md mx-auto p-6 bg-white shadow-md rounded-lg"
>
  <div class="mb-6">
    <label for="name" class="block text-sm font-medium text-gray-700"
      >Name:</label
    >
    <input
      type="text"
      formControlName="name"
      id="name"
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
    />
    <!-- Error message for Name -->
    <div
      *ngIf="
        profileForm.get('name')!.touched && profileForm.get('name')!.invalid
      "
      class="text-red-500 text-sm mt-1"
    >
      <span *ngIf="profileForm.get('name')!.errors?.['required']">
        Name is required.
      </span>
    </div>
  </div>
  <div class="mb-6">
    <label for="profilePicture" class="block text-sm font-medium text-gray-700"
      >Profile Picture:</label
    >
    <input
      type="file"
      (change)="onProfilePictureSelected($event)"
      id="profilePicture"
      accept="image/*"
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
    />
  </div>
  <div class="mb-6">
    <label for="age" class="block text-sm font-medium text-gray-700"
      >Age:</label
    >
    <input
      type="text"
      formControlName="age"
      id="age"
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
    />
    <!-- Error message for Age -->
    <div
      *ngIf="profileForm.get('age')!.touched && profileForm.get('age')!.invalid"
      class="text-red-500 text-sm mt-1"
    >
      <span *ngIf="profileForm.get('age')!.errors?.['required']">
        Age is required.
      </span>
    </div>
  </div>
  <div formArrayName="workExperiences">
    <div
      *ngFor="let workExperience of workExperiences.controls; let i = index"
      [formGroupName]="i"
      class="bg-gray-100 rounded-lg p-6 mb-6"
    >
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">
          Work Experience {{ i + 1 }}
        </h3>
        <button
          type="button"
          (click)="removeWorkExperience(i)"
          class="px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 focus:outline-none focus:bg-red-600"
        >
          Remove
        </button>
      </div>
      <div class="grid grid-cols-1 gap-4">
        <div>
          <label
            for="startDate{{ i }}"
            class="block text-sm font-medium text-gray-700"
            >Start Date:</label
          >
          <input
            type="date"
            formControlName="startDate"
            id="startDate{{ i }}"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
          />
          <!-- Error message for Start Date -->
          <div
            *ngIf="
              profileForm.get('workExperiences.' + i + '.startDate')!.touched &&
              profileForm.get('workExperiences.' + i + '.startDate')!.invalid
            "
            class="text-red-500 text-sm mt-1"
          >
            <span
              *ngIf="profileForm.get('workExperiences.' + i + '.startDate')!.errors?.['required']"
            >
              Start Date is required.
            </span>
          </div>
        </div>
        <div *ngIf="!workExperience.get('current')!.value">
          <label
            for="endDate{{ i }}"
            class="block text-sm font-medium text-gray-700"
            >End Date:</label
          >
          <input
            type="date"
            formControlName="endDate"
            id="endDate{{ i }}"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
          />
        </div>
        <div>
          <label for="current{{ i }}" class="flex items-center">
            <input
              type="checkbox"
              formControlName="current"
              id="current{{ i }}"
              class="mr-2 leading-tight"
            />
            <span class="text-sm font-medium text-gray-700"
              >Current Position</span
            >
          </label>
        </div>
        <div>
          <label
            for="jobTitle{{ i }}"
            class="block text-sm font-medium text-gray-700"
            >Job Title:</label
          >
          <input
            type="text"
            formControlName="jobTitle"
            id="jobTitle{{ i }}"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
          />
          <!-- Error message for Job Title -->
          <div
            *ngIf="
              profileForm.get('workExperiences.' + i + '.jobTitle')!.touched &&
              profileForm.get('workExperiences.' + i + '.jobTitle')!.invalid
            "
            class="text-red-500 text-sm mt-1"
          >
            <span
              *ngIf="profileForm.get('workExperiences.' + i + '.jobTitle')!.errors?.['required']"
            >
              Job Title is required.
            </span>
          </div>
        </div>
        <div>
          <label
            for="company{{ i }}"
            class="block text-sm font-medium text-gray-700"
            >Company Name:</label
          >
          <input
            type="text"
            formControlName="company"
            id="company{{ i }}"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
          />
          <!-- Error message for Company Name -->
          <div
            *ngIf="
              profileForm.get('workExperiences.' + i + '.company')!.touched &&
              profileForm.get('workExperiences.' + i + '.company')!.invalid
            "
            class="text-red-500 text-sm mt-1"
          >
            <span
              *ngIf="profileForm.get('workExperiences.' + i + '.company')!.errors?.['required']"
            >
              Company Name is required.
            </span>
          </div>
        </div>
        <div>
          <label
            for="jobDescription{{ i }}"
            class="block text-sm font-medium text-gray-700"
            >Job Description:</label
          >
          <textarea
            formControlName="jobDescription"
            id="jobDescription{{ i }}"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
          ></textarea>
          <!-- Error message for Job Description -->
          <div
            *ngIf="
              profileForm.get('workExperiences.' + i + '.jobDescription')!
                .touched &&
              profileForm.get('workExperiences.' + i + '.jobDescription')!
                .invalid
            "
            class="text-red-500 text-sm mt-1"
          >
            <span
              *ngIf="profileForm.get('workExperiences.' + i + '.jobDescription')!.errors?.['required']"
            >
              Job Description is required.
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error message for server-side errors -->
  <span *ngIf="errorMessage" class="text-red-500 text-sm">
    {{ errorMessage }}
  </span>

  <button
    type="button"
    (click)="addWorkExperience()"
    class="mt-4 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 focus:outline-none focus:bg-green-600"
  >
    Add Work Experience
  </button>
  <button
    type="submit"
    class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:bg-blue-600"
  >
    Submit
  </button>
</form>
